(()=>{"use strict";const t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function e(t){const[e,r]=t.split(":");return 60*(parseInt(e,10)||0)+(parseInt(r,10)||0)}function r(r,o,n){const s=[];return function(t,r,o){const n=e(t);let s=e(r);s<=n&&(s+=1440);const a=[];for(let t=n;t<=s;t+=o)a.push(t);return a}(o,n,r).forEach((e=>{const r=[function(t){const e=Math.floor(t/60)%24,r=e>=12?"PM":"AM";return`${e%12==0?12:e%12}:${(t%60).toString().padStart(2,"0")} ${r}`}(e)];for(let e=0;e<t.length;e++)r.push("");s.push(r)})),s}function o(t,e){if(!t)throw new Error(`Required element with id "${e}" not found`);return t}class n{static async getLocal(t){return new Promise(((e,r)=>{chrome.storage.local.get(t,(t=>{chrome.runtime.lastError?(console.error("[Storage] Error reading from local storage:",chrome.runtime.lastError),r(chrome.runtime.lastError)):(console.log("[Storage] Successfully read from local storage:",t),e(t))}))}))}static async setLocal(t){return new Promise(((e,r)=>{chrome.storage.local.set(t,(()=>{chrome.runtime.lastError?(console.error("[Storage] Error saving to local storage:",chrome.runtime.lastError),r(chrome.runtime.lastError)):(console.log("[Storage] Successfully saved to local storage:",Object.keys(t)),e())}))}))}static async getSync(t){return new Promise(((e,r)=>{chrome.storage.sync.get(t,(t=>{chrome.runtime.lastError?(console.error("[Storage] Error reading from sync storage:",chrome.runtime.lastError),r(chrome.runtime.lastError)):(console.log("[Storage] Successfully read from sync storage:",t),e(t))}))}))}static async setSync(t){return new Promise(((e,r)=>{chrome.storage.sync.set(t,(()=>{chrome.runtime.lastError?(console.error("[Storage] Error saving to sync storage:",chrome.runtime.lastError),r(chrome.runtime.lastError)):(console.log("[Storage] Successfully saved to sync storage:",Object.keys(t)),e())}))}))}static async removeLocal(t){return new Promise(((e,r)=>{chrome.storage.local.remove(t,(()=>{chrome.runtime.lastError?(console.error("[Storage] Error removing from local storage:",chrome.runtime.lastError),r(chrome.runtime.lastError)):(console.log("[Storage] Successfully removed from local storage:",t),e())}))}))}static async removeSync(t){return new Promise(((e,r)=>{chrome.storage.sync.remove(t,(()=>{chrome.runtime.lastError?(console.error("[Storage] Error removing from sync storage:",chrome.runtime.lastError),r(chrome.runtime.lastError)):(console.log("[Storage] Successfully removed from sync storage:",t),e())}))}))}}class s{constructor(){this.greetingEl=o(document.getElementById("greeting"),"greeting"),this.todayList=o(document.getElementById("today-list"),"today-list"),this.upcomingList=o(document.getElementById("upcoming-list"),"upcoming-list"),this.tasksList=o(document.getElementById("tasks-list"),"tasks-list"),this.editBtn=o(document.getElementById("edit-btn"),"edit-btn"),this.initialize()}async initialize(){try{await this.applyThemePreferences(),this.displayGreeting(),await this.loadAndDisplayData(),this.setupEventListeners()}catch(t){console.error("[Popup] Error during initialization:",t)}}async applyThemePreferences(){try{const t=await n.getLocal(["theme","customColors"]),e=function(t,e){return"custom"===t&&e?e:"dark"===t?{backgroundColor:"#121212",textColor:"#ffffff",primaryColor:"#bb86fc",secondaryColor:"#03dac6",borderColor:"#333333"}:{backgroundColor:"#ffffff",textColor:"#000000",primaryColor:"#4CAF50",secondaryColor:"#6c757d",borderColor:"#dddddd"}}(t.theme||"light",t.customColors);!function(t){document.documentElement.style.setProperty("--background-color",t.backgroundColor),document.documentElement.style.setProperty("--text-color",t.textColor),document.documentElement.style.setProperty("--primary-color",t.primaryColor),document.documentElement.style.setProperty("--secondary-color",t.secondaryColor),document.documentElement.style.setProperty("--border-color",t.borderColor)}(e)}catch(t){console.error("[Popup] Error applying theme:",t)}}displayGreeting(){const t=new Date,e=function(){const t=(new Date).getHours();return t<12?"Good Morning":t<18?"Good Afternoon":"Good Evening"}();this.greetingEl.textContent=`${e}! Today is ${t.toDateString()}`}async loadAndDisplayData(){try{const t=await n.getLocal(["weekMap","weekStart","timeIncrement","dayStart","dayEnd","eventsData","tasksData"]),e=parseInt(t.timeIncrement||"60",10),o=t.dayStart||"08:00",s=t.dayEnd||"22:00",a=t.eventsData||[],c=t.tasksData||[];let i;if(t.weekMap&&t.weekStart){const n=new Date(t.weekStart).toISOString().substring(0,10);i=t.weekMap[n]||r(e,o,s)}else i=r(e,o,s);this.displayTodaySchedule(i,a),this.displayUpcomingEvents(a),this.displayTasks(c)}catch(t){console.error("[Popup] Error loading and displaying data:",t)}}displayTodaySchedule(t,e){this.todayList.innerHTML="";const r=(new Date).getDay()+1;t.forEach((t=>{const e=t[0],o=t[r];if(o&&""!==o.trim()){const t=document.createElement("li");t.textContent=`${e}: ${o}`,this.todayList.appendChild(t)}}));const o=new Date;if(e.forEach((t=>{try{const n=new Date(`${t.date}T${t.time}`);if(r=o,(e=n).getFullYear()===r.getFullYear()&&e.getMonth()===r.getMonth()&&e.getDate()===r.getDate()){const e=document.createElement("li");e.textContent=`${t.time}: ${t.title}`,this.todayList.appendChild(e)}}catch(e){console.error("[Popup] Error processing event:",t,e)}var e,r})),0===this.todayList.children.length){const t=document.createElement("li");t.textContent="No activities scheduled for today",t.style.fontStyle="italic",t.style.color="var(--secondary-color)",this.todayList.appendChild(t)}}displayUpcomingEvents(t){this.upcomingList.innerHTML="";const e=new Date,r=t.filter((t=>{try{const r=(new Date(`${t.date}T${t.time}`).getTime()-e.getTime())/864e5;return r>0&&r<=7}catch(e){return console.error("[Popup] Error filtering event:",t,e),!1}}));if(r.sort(((t,e)=>{try{const r=new Date(`${t.date}T${t.time}`),o=new Date(`${e.date}T${e.time}`);return r.getTime()-o.getTime()}catch(t){return console.error("[Popup] Error sorting events:",t),0}})),r.forEach((t=>{const e=document.createElement("li");e.textContent=`${t.date} ${t.time}: ${t.title}`,this.upcomingList.appendChild(e)})),0===r.length){const t=document.createElement("li");t.textContent="No upcoming events in the next 7 days",t.style.fontStyle="italic",t.style.color="var(--secondary-color)",this.upcomingList.appendChild(t)}}displayTasks(t){if(this.tasksList.innerHTML="",t.forEach((t=>{const e=document.createElement("li");e.textContent=t.title,this.tasksList.appendChild(e)})),0===t.length){const t=document.createElement("li");t.textContent="No tasks added",t.style.fontStyle="italic",t.style.color="var(--secondary-color)",this.tasksList.appendChild(t)}}setupEventListeners(){this.editBtn.addEventListener("click",(()=>{chrome.runtime.openOptionsPage()}))}}document.addEventListener("DOMContentLoaded",(()=>{console.log("[Popup] DOM loaded, initializing popup manager"),new s}))})();